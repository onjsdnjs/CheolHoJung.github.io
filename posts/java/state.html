<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[OOP] 스테이트 패턴 | jcheolho</title>
    <meta name="description" content="헤드퍼스트 디자인패턴에 등장하는 스테이트 패턴에 대한 설명">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="apple-mobile-web-app-title" content="MY APPLE TITLE">
  <meta name="theme-color" content="MY COLOR THEME">
  <meta name="msapplication-navbutton-color" content="MY COLOR THEME">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="coverage" content="WorldWide">
  <meta name="rating" content="general">
  <meta name="robots" content="index,follow">
  <meta name="googlebot" content="index,follow">
  <meta name="application-name" content="MY APP NAME">
  <meta name="msapplication-TileColor" content="MY COLOR THEME">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta name="msapplication-square70x70logo" content="/favicon/ms-icon-70x70.png">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="msapplication-square150x150logo" content="/favicon/mstile-150x150.png">
  <meta name="msapplication-wide310x150logo" content="/favicon/ms-icon-310x310.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ktquez">
  <meta property="fb:app_id" content="MY FACEBOOK APP ID">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="MY SITE NAME">
  <meta property="og:image:height" content="1200">
  <meta property="og:image:width" content="360">
  <meta property="og:image:type" content="image/png">
  <meta name="google-site-verification" content="SK1Dxps2G8JE4dN1BZISZg9_VW99typSNHvfcOOY_w0">
  <meta name="msvalidate.01" content="MY VERIFICATION KEY">
  <meta name="yandex-verification" content="MY VERIFICATION KEY">
  <link rel="publisher" href="MY URL GOOGLE PLUS">
  <link rel="author" href="MY URL GOOGLE PLUS">
  <link rel="author" href="/humans.txt">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon/android-icon-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ff5733">
  <link rel="shortcut icon" href="/favicon/favicon.ico">
  <link rel="alternate" href="https://cheolhojung.github.io/" hreflang="en">
  <link rel="alternate" href="https://cheolhojung.github.io/pt/" hreflang="pt">
  <link rel="alternate" href="https://cheolhojung.github.io/pt/" hreflang="pt-br">
  <link rel="alternate" href="https://cheolhojung.github.io/es/" hreflang="es">
  <link rel="preconnect" href="https://connect.facebook.net/">
  <link rel="preconnect" href="https://platform.twitter.com/">
  <link rel="preconnect" href="https://widget.sndcdn.com/">
  <link rel="preconnect" href="https://api-widget.soundcloud.com/">
  <link rel="preconnect" href="https://www.youtube.com/">
  <link rel="preconnect" href="https://scrimba.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/">
  <link rel="preconnect" href="https://c.disquscdn.com/">
  <link rel="preconnect" href="https://disqus.com/">
  <link rel="preconnect" href="https://www.google-analytics.com/">
  <link rel="preconnect" href="https://stats.g.doubleclick.net">
  <link rel="preload" href="https://www.google-analytics.com/analytics.js" as="script">
    
    <link rel="preload" href="/assets/css/0.styles.46345aac.css" as="style"><link rel="preload" href="/assets/js/app.bfe739c4.js" as="script"><link rel="preload" href="/assets/js/13.9279a9ff.js" as="script"><link rel="preload" href="/assets/js/3.23193c0c.js" as="script"><link rel="preload" href="/assets/js/12.3e016781.js" as="script"><link rel="preload" href="/assets/js/11.809e9d83.js" as="script"><link rel="preload" href="/assets/js/16.1c2833b5.js" as="script"><link rel="preload" href="/assets/js/2.5fe2a2c5.js" as="script"><link rel="preload" href="/assets/js/5.b501fc84.js" as="script"><link rel="preload" href="/assets/js/6.14ae626b.js" as="script"><link rel="preload" href="/assets/js/17.49af5d66.js" as="script"><link rel="preload" href="/assets/js/55.8758e0e4.js" as="script"><link rel="preload" href="/assets/js/7.2fece6bb.js" as="script"><link rel="preload" href="/assets/js/1.68f42ae0.js" as="script"><link rel="preload" href="/assets/js/9.9f978aa2.js" as="script"><link rel="preload" href="/assets/js/14.53747437.js" as="script"><link rel="preload" href="/assets/js/4.b9cce61f.js" as="script"><link rel="prefetch" href="/assets/js/10.d436c47b.js"><link rel="prefetch" href="/assets/js/15.af58e987.js"><link rel="prefetch" href="/assets/js/18.6c04c596.js"><link rel="prefetch" href="/assets/js/19.3001a8f4.js"><link rel="prefetch" href="/assets/js/20.19f86536.js"><link rel="prefetch" href="/assets/js/21.dc23099d.js"><link rel="prefetch" href="/assets/js/22.51d23d69.js"><link rel="prefetch" href="/assets/js/23.e8858003.js"><link rel="prefetch" href="/assets/js/24.b8e3ecf7.js"><link rel="prefetch" href="/assets/js/25.24b2b6de.js"><link rel="prefetch" href="/assets/js/26.261042dd.js"><link rel="prefetch" href="/assets/js/27.eb85d0f6.js"><link rel="prefetch" href="/assets/js/28.f34f654f.js"><link rel="prefetch" href="/assets/js/29.ec45eb7b.js"><link rel="prefetch" href="/assets/js/30.53ea0a56.js"><link rel="prefetch" href="/assets/js/31.0e6ecd36.js"><link rel="prefetch" href="/assets/js/32.a87f3de7.js"><link rel="prefetch" href="/assets/js/33.3109da63.js"><link rel="prefetch" href="/assets/js/34.764a53b8.js"><link rel="prefetch" href="/assets/js/35.286c1ca0.js"><link rel="prefetch" href="/assets/js/36.b8b332b4.js"><link rel="prefetch" href="/assets/js/37.57321a41.js"><link rel="prefetch" href="/assets/js/38.6777de52.js"><link rel="prefetch" href="/assets/js/39.fefed142.js"><link rel="prefetch" href="/assets/js/40.4dfe5121.js"><link rel="prefetch" href="/assets/js/41.95291ea9.js"><link rel="prefetch" href="/assets/js/42.7c4934ce.js"><link rel="prefetch" href="/assets/js/43.c1e50db4.js"><link rel="prefetch" href="/assets/js/44.52a495f9.js"><link rel="prefetch" href="/assets/js/45.10cd9aee.js"><link rel="prefetch" href="/assets/js/46.fdd4a2a5.js"><link rel="prefetch" href="/assets/js/47.f8dec09a.js"><link rel="prefetch" href="/assets/js/48.c1469814.js"><link rel="prefetch" href="/assets/js/49.27f1fd45.js"><link rel="prefetch" href="/assets/js/50.3fd45b06.js"><link rel="prefetch" href="/assets/js/51.b0be96f6.js"><link rel="prefetch" href="/assets/js/52.9c6fb38c.js"><link rel="prefetch" href="/assets/js/53.9a0a4361.js"><link rel="prefetch" href="/assets/js/54.85b4dac7.js"><link rel="prefetch" href="/assets/js/56.fc1cda38.js"><link rel="prefetch" href="/assets/js/57.d9dc0ea8.js"><link rel="prefetch" href="/assets/js/58.a4e83cf9.js"><link rel="prefetch" href="/assets/js/59.cee413a4.js"><link rel="prefetch" href="/assets/js/60.76cee8af.js"><link rel="prefetch" href="/assets/js/61.696f835c.js"><link rel="prefetch" href="/assets/js/62.e7d9d242.js"><link rel="prefetch" href="/assets/js/63.944172e7.js"><link rel="prefetch" href="/assets/js/64.fd9ffaa4.js"><link rel="prefetch" href="/assets/js/65.f08d54f5.js"><link rel="prefetch" href="/assets/js/66.15913d89.js"><link rel="prefetch" href="/assets/js/67.ab94061c.js"><link rel="prefetch" href="/assets/js/68.b90c5ab1.js"><link rel="prefetch" href="/assets/js/69.4ec6e695.js">
    <link rel="stylesheet" href="/assets/css/0.styles.46345aac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div itemscope="itemscope" itemtype="https://schema.org/WebPage" class="layout-main"><meta itemprop="name" content="jcheolho"> <meta itemprop="alternateName" content="jcheolho"> <meta itemprop="url" content="https://cheolhojung.github.io"> <nav aria-label="Navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement" class="container nav-mobile" style="display:none;"><span itemprop="headline" class="nav-mobile__title">Navigation</span> <ul class="nav-mobile__list"><li class="nav-mobile__item"><a href="/about/" itemprop="url" class="nav-mobile__link"><span class="bullet no_bw bullet--primary bullet--undefined"></span> <span class="text">ABOUT</span></a></li><li class="nav-mobile__item"><a href="/categories/" itemprop="url" class="nav-mobile__link"><span class="bullet no_bw bullet--primary bullet--undefined"></span> <span class="text">CATEGORIES</span></a></li><li class="nav-mobile__item"><a href="/contact/" itemprop="url" class="nav-mobile__link"><span class="bullet no_bw bullet--primary bullet--undefined"></span> <span class="text">CONTACT</span></a></li><li class="nav-mobile__item"><a href="/categories/java.html" itemprop="url" class="nav-mobile__link"><span class="bullet no_bw bullet--primary bullet--undefined"></span> <span class="text">Java</span></a></li><li class="nav-mobile__item"><a href="/categories/vuejs.html" itemprop="url" class="nav-mobile__link"><span class="bullet no_bw bullet--primary bullet--undefined"></span> <span class="text">Vue.js</span></a></li></ul></nav> <div class="container-fluid wrapper-body__nm"><header itemscope="itemscope" itemtype="https://schema.org/Organization" class="header"><!----> <div class="row header-top"><div class="column xs-33 sm-20"><div class="hamburguer header-top__hamburguer"><div class="hamburguer__wrapper"><span class="hamburguer__line"></span> <span class="hamburguer__line"></span> <span class="hamburguer__line"></span></div></div> <!----></div> <div class="column xs-33 sm-60"><div class="header__logo"><a href="/" itemprop="url" class="header-top-logo__link router-link-active"><img itemprop="logo" src="/ktquez-play-logo.png" srcset="/ktquez-play-logo.png 1x, /ktquez-play-logo@2x.png 2x" alt="Logo in 3 colors in play format"></a></div> <meta itemprop="name" content="jcheolho"> <meta itemprop="sameAs" content="https://github.com/CheolHoJung"></div> <div class="column xs-33 sm-20"><div class="search header-top__search"><!----> <span class="icon search__icon">search</span></div> <div class="switch-bw header-top__toggle"><span class="switch-bw__text">
      Turn on night mode
    </span> <label for="switch-bw" class="switch-bw__label"><input type="checkbox" id="switch-bw" name="switch-bw" aria-labelledby="switch-bw-text" class="switch-bw__input"> <span class="switch-bw__ball"></span> <span id="switch-bw-text" hidden="hidden">switch to black or white</span></label></div></div></div></header> <main id="main" itemscope="itemscope" itemtype="https://schema.org/Blog" class="main-page"><div><a href="#main" class="vue-skip-to">Skip to main content</a> <div><div class="page page__full row justify-right"><article itemscope="itemscope" itemprop="blogPost" itemtype="https://schema.org/BlogPosting" class="column xs-100 page__full__box box-default"><meta itemprop="mainEntityOfPage" content="/posts/java/state.html"> <header class="page-header page__full-header"><button type="button" class="ui-button reset-button back-button"><span class="icon back-button__icon icon--arrow">arrow</span> <span class="back-button__text">Back</span></button> <div class="page-header__meta"><time datetime="2018-03-28 17:40" itemprop="datePublished" class="text">
                  
              </time> <meta itemprop="dateModified" content="currentPost.updated_at"> <!----></div> <h1 itemprop="name headline" class="page-header__title">[OOP] 스테이트 패턴</h1> <div class="page-header-cat"><nav class="page-header-cat__nav"><ul class="page-header-cat__list"><li class="page-header-cat__item"><a href="/categories/java.html" itemprop="keywords" class="page-header-cat__link meta-text">
                    Java
                  </a></li></ul></nav></div> <div itemprop="author" itemscope="itemscope" itemtype="https://schema.org/Person" class="page-header__author"><strong>Author: </strong> <a href="/authors/jcheolho.html" rel="author" itemprop="url" class="link link--filler-s-primary"><span itemprop="name">CheolHo Jung</span></a></div></header> <!----> <!----> <section class="page-content page__full-content"><div class="row"><div class="column no-pad-l sm-50 post-share"><div class="observer"><!----> <!----> <!----></div></div> <!----></div> <div class="row"><div class="column no-pad-l md-75 xl-67 post-content"><div class="post-content__box-player"><!----></div> <div class="post-content__excerpt"><!----></div> <div class="post-content__table-contents"><div class="table-contents"><h3 id="table-of-content" class="table-contents__title">Table of contents</h3> <nav><ol class="table-contents__list"><li class="table-contents__item"><a href="#다이어그램" title="다이어그램" class="table-contents__link"><span>다이어그램</span></a></li><li class="table-contents__item"><a href="#예시" title="예시" class="table-contents__link"><span>예시</span></a></li><li class="table-contents__item"><a href="#스테이트-패턴을-도입하면서-생긴-이점" title="스테이트 패턴을 도입하면서 생긴 이점" class="table-contents__link"><span>스테이트 패턴을 도입하면서 생긴 이점</span></a></li><li class="table-contents__item"><a href="#스테이트-패턴-vs-스트래티지-패턴" title="스테이트 패턴 VS 스트래티지 패턴" class="table-contents__link"><span>스테이트 패턴 VS 스트래티지 패턴</span></a></li><li class="table-contents__item"><a href="#의문점" title="의문점" class="table-contents__link"><span>의문점</span></a></li><li class="table-contents__item"><a href="#마무리" title="마무리" class="table-contents__link"><span>마무리</span></a></li></ol></nav></div></div> <div itemprop="articleBody"><div class="content custom"><p>지난 포스팅에선 트리 구조를 구성하여 부분과 전체를 나타내는 계층구조로 표현할 수 있는 컴포지트 패턴에 대해 알아보았다. 이번에는 객체 내부의 상태가 바뀜에 따라 객체의 행동을 바꿀 수 있는 스테이트 패턴에 대해 복습한다.</p> <p>스테이트 패턴은 <strong>상태를 별도의 클래스로 캡슐화한 다음 현재 상태를 나타내는 객체에게 행동을 위임</strong>한다. 객체의 내부 상태가 바뀜에 따라서 객체의 행동을 변경한다. 마치 객체의 클래스가 바뀌는 것과 같은 결과를 얻을 수 있다.  즉, 내부 상태가 바뀜에 따라 행동이 달라지게 된다.</p> <p>스테이트 패턴은 if, switch문과 같은 분기문을 패턴을 이용해 캡슐화한다. <code>객체의 클래스가 바뀌는 것과 같은</code> 이라는 표현을 쓴 이유는 무엇일까? 클라이언트 입장에서는 사용하는 객체의 행동이 완전히 달라진다면 마치 그 객체가 다른 클래스로부터 만들어진 객체처럼 느껴진다. 실제로는 다른 클래스로 변신하는 게 아니고 구성을 통해서 여러 상태 객체를 바꿔가면서 사용한다.</p> <h2 id="다이어그램"><a href="#다이어그램" aria-hidden="true" class="header-anchor">#</a> 다이어그램</h2> <div class="observer"><div class="spinner observer__spinner"><div class="double-bounce1"></div> <div class="double-bounce2"></div></div> <!----> <!----></div> <p><strong>Context는 여러 가지 내부 상태를 가질 수 있는 클래스</strong>로, request() 메소드가 호출되면 <strong>상태 객체에게 그 작업을 위임</strong>한다.</p> <p><strong>State는 모든 구상 상태클래스에 대한 공통 인터페이스를 정의</strong>한다.</p> <p>ConcreateState는 Context로 부터 전달된 요청을 처리하는 구상 상태클래스이다. 구상 클래스는 요청을 처리하는 방법을 자기 나름의 방식으로 구현한다.</p> <h2 id="예시"><a href="#예시" aria-hidden="true" class="header-anchor">#</a> 예시</h2> <p>뽑기기계에 대한 예시를 살펴보자. 클래스는 상태와 행동으로 모든 것을 표현한다.  뽑기기계에 동전을 넣고 손잡이를 돌리고 어떤 물체가 나오기까지 일련의 과정을 그려보자.</p> <div class="observer"><div class="spinner observer__spinner"><div class="double-bounce1"></div> <div class="double-bounce2"></div></div> <!----> <!----></div> <blockquote><p>상태</p></blockquote> <ul><li>동전 없음</li> <li>동전 있음</li> <li>알맹이 판매</li> <li>알맹이 매진</li></ul> <blockquote><p>행동</p></blockquote> <ul><li>동전 투입
<ul><li>동전 있음 상태로 전환</li></ul></li> <li>동전 반환
<ul><li>동전 없음 상태로 전환</li></ul></li> <li>손잡이 돌림
<ul><li>알맹이 판매 상태로 전환</li></ul></li> <li>알맹이를 내보냄
<ul><li>알맹이 매진 상태로 전환</li> <li>동전없음 상태로 전환</li></ul></li></ul> <p>뽑기 기계는 4개의 상태와 4개의 행동으로 구성된다. 행동은 4개지만 다른 상태로 넘어가는 전환의 종류는 5가지다.</p> <ol><li>뽑기 기계를 **동전 없음 ** 상태로 시작한다.</li> <li>여기서 동전을 넣으면 <strong>동전 있음</strong> 상태가 된다.</li> <li>동전을 넣고 손잡이를 돌리면 <strong>알맹이 판매</strong> 상태가 된다.</li> <li>알맹이 판매 상태는 다시 알맹이의 개수를 검사해서 <strong>동전 없음</strong> 혹은 <strong>알맹이 매진</strong> 상태가 된다.</li></ol> <p>중요한 것은 이런 뽑기 기계를 이용할 때 동전이 없는 상태에서 동전을 반환 받으려고 한다거나, 동전이 이미 들어있는데 하나 더 집어넣으려고 하는 것처럼 <strong>이상한 행동을 할 수도 있다는 것을 기억해야 하는 것</strong>이다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GumballMachine</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> SOLD_OUT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> NO_QUARTER <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> HAS_QUARTER <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> SOLD <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> state <span class="token operator">=</span> SOLD_OUT<span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">GumballMachine</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state <span class="token operator">=</span> NO_QUARTER<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>만약, 스테이트 패턴을 이용하지 않고 각각의 행동을 구현하려면 if문으로 state의 상태에 따라 행동을 분기해야 하므로  상태가 추가될 때마다 모든 메소드에 코드를 추가해야 하는 불편함이 있다. 코드를 변경해야 하며 특정 메소드는 더 많이 변경해야 할 수도 있다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>상태 <span class="token operator">==</span> 동전있음<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>상태 <span class="token operator">==</span> 동전없음<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>상태 <span class="token operator">==</span> 알맹이 판매<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>상태 <span class="token operator">==</span> 알맹이 매진<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>제어문을 통해서 상태에 따라 분기를 할 경우 해당 제어문에 조건과 행동을 계속해서 추가해야한다. 변경이 일어나는 부분은 변하지 않는 부분으로부터 분리해야한다. <strong>스테이트 패턴을 적용해서 각 상태의 행동을 별도의 클래스에 집어넣고 모든 상태에서 각각 자기가 할 일을 구현</strong>한다. 이는 <strong>구성을 활용하는 것이며 결국 스테이트 패턴을 이용하는 것</strong>이다.</p> <p>스테이트 패턴을 적용하더라도 <strong>새로운 상태가 추가되면 코드를 고치긴 해야한다</strong>. 하지만, <strong>상태 클래스를 새로 추가하고 전환과 관련된 코드만 손보면 된다</strong>. 제어문을 이용한 방식에 비해 훨씬 <strong>유연해진다</strong>. 이제 뽑기 기계를 스테이트 패턴을 이용해서 변경해보자.</p> <div class="observer"><div class="spinner observer__spinner"><div class="double-bounce1"></div> <div class="double-bounce2"></div></div> <!----> <!----></div> <p>상태를 클래스로 정의하고 행동을 메소드로 정의한다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GumballMachine</span> <span class="token punctuation">{</span>
    State soldOutState<span class="token punctuation">;</span>
    State noQuarterState<span class="token punctuation">;</span>
    State hasQuarterState<span class="token punctuation">;</span>
    State soldState<span class="token punctuation">;</span>
    State state <span class="token operator">=</span> soldOutState<span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">GumballMachine</span><span class="token punctuation">(</span><span class="token keyword">int</span> numberGumballs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        soldOutState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoldOutState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        noQuarterState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NoQuarter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hasQuarterState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HasQuarterState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        soldState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoldState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> numberGumballs<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>numberGumballs <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state <span class="token operator">=</span> noQuarterState<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span><span class="token function">insertQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ejectQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span><span class="token function">ejectQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">turnQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span><span class="token function">turnQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>State state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">releaseBall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            count <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>나머지 코드는 굳이 볼 필요가 없으므로 뽑기 기계의 코드만 살펴보자. 제어문을 통해 상태를 검사해 행동을 분기하는 코드가 없어졌다. 대신 상태를 위한 인터페이스와 구상 클래스를 변수로 갖는다. 각각의 행동이 호출되면 state 객체에게 행동을 위임하면 된다. 결국 뽑기기계의 상태에 맞는 상태 객체가 요청을 위임받아 처리하게 될 것이다.</p> <p>HasQuarterState가 요청을 위임받았다고 가정해보자. HasQuarterState는 동전이 들어있는 상태를 나타내는 클래스이므로 <strong>동전을 넣을 경우 반환하고 오류를 알려야한다</strong>. <strong>동전을 반환하는 경우</strong>에는 아무 문제가 없으므로 동전을 반환하고 **동전없음 **상태로 전환한다. 반대로 <strong>손잡이를 돌릴 경우</strong>에는 아무런 문제가 없으므로 <strong>알맹이 판태</strong> 상태로 전환한다. HasQuarterState처럼 나머지 상태에서도 각각 상태에 알맞게 메소드를 구현하면 된다.</p> <h2 id="스테이트-패턴을-도입하면서-생긴-이점"><a href="#스테이트-패턴을-도입하면서-생긴-이점" aria-hidden="true" class="header-anchor">#</a> 스테이트 패턴을 도입하면서 생긴 이점</h2> <ul><li>각 상태의 행동을 별개의 클래스로 국지화시켰다.
<ul><li>캡슐화</li></ul></li> <li>관리하기 힘든 골칫덩어리 if 선언문들을 없앴다.
<ul><li>유연성</li></ul></li> <li>각 상태를 변경에 대해서는 닫혀 있도록 하면서도 뽑기 기계 자체는 새로운 클래스를 추가하는 확장에 대해서 열려 있도록 고쳤다.
<ul><li>OCP</li></ul></li></ul> <h2 id="스테이트-패턴-vs-스트래티지-패턴"><a href="#스테이트-패턴-vs-스트래티지-패턴" aria-hidden="true" class="header-anchor">#</a> 스테이트 패턴 VS 스트래티지 패턴</h2> <blockquote><p>스테이트 패턴은 상태 객체에 일련의 행동이 캡슐화된다.</p></blockquote> <p>스테이트 패턴에서는 상황에 따라 Context 객체에서 여러 상태 객체 중 한 객체에게 모든 행동을 맡기게 된다. 내부 상태에 따라 현재 상태를 나타내는 객체가 바뀌게 되고, 결국 컨텍스트 객체의 행동도 자연스럽게 바뀌게 된다. 클라이언트는 이러한 상태와 전환 과정을 거의 몰라도 된다.</p> <blockquote><p>스트래티지 패턴은 일반적으로 클라이언트에서 컨텍스트 객체한테 어떤 전략 객체를 사용할지를 지정해준다.</p></blockquote> <p>스트래티지 패턴은 주로 실행시에 전략 객체를 변경할 수 있는 유연성을 제공한다. 반대로 상황에 따라 적합한 전략 객체를 선택해서 사용한다.</p> <blockquote><p>스트래티지 패턴은 서브클래스를 만드는 방법을 대신하여 유연성을 극대화하기 위한 용도로 쓰인다.</p></blockquote> <p>상속을 이용해서 클래스의 행동을 정의하다 보면 행동을 변경하기가 힘들다. 구성을 이용하면 행동을 정의하는 객체를 유연하게 바꿀 수 있다.</p> <blockquote><p>스테이트 패턴은 컨텍스트 객체에 수많은 조건문을 집어넣는 대신에 사용할 수 있는 패턴이라고 할 수 있다.</p></blockquote> <p>행동을 상태 객체 내에 캡슐화시키면 컨텍스트 내의 상태 객체를 바꾸는 것만으로도 컨텍스트 객체의 행동을 바꿀 수 있다.</p> <h2 id="의문점"><a href="#의문점" aria-hidden="true" class="header-anchor">#</a> 의문점</h2> <blockquote><p>뽑기기계의 상태에 의해서 다음 상태가 결정된다. 반드시 구상 상태 클래스에서 다음 상태를 결정해야 하는가?</p></blockquote> <p>항상 그렇지는 않다. Context에서 상태 전환의 흐름을 결정하도록 할 수 있다. 상태 전환이 고정되어있는 경우에는 이러한 흐름을 Context에 넣어도 된다. 하지만 상태 전환이 동적으로 결정되는 경우 상태 클래스 내에서 처리하는 것이 좋다.</p> <blockquote><p>클라이언트에서 상태 객체하고 직접 연락을 하는 경우도 있는가?</p></blockquote> <p>그런 일은 없다. 상태는 Context쪽에서 사용할 내부 상태 및 행동을 표현하기 위한 용도이기 때문에 상태에 대한 요청은 전부 Context로부터 오게 된다.</p> <blockquote><p>Context의 인스턴스가 아주 많은 경우 여러 인스턴스에서 상태 객체를 공유할 수 있는가?</p></blockquote> <p>실제로 여러 인스턴스에서 상태 객체를 공유하는 경우가 흔히 있다. 상태 객체 내에 자체 상태를 보관하지 않아야 한다는 조건만 만족되면 상관 없다. 상태 객체 내에 자체 상태를 보관해야 한다면, 각 Context마다 유일한 객체가 필요하기 때문이다.</p> <h2 id="마무리"><a href="#마무리" aria-hidden="true" class="header-anchor">#</a> 마무리</h2> <p>디자인 패턴을 사용하다보면 필요한 클래스의 개수가 많아지는 것은 어쩔 수 없다. 상황에 맞게 적절한 패턴과 원칙을 적용하고, 필요하다면 변종을 만드는 것도 필요하다.</p> <p><a href="https://github.com/iluwatar/java-design-patterns/tree/master/state" target="_blank" rel="noopener noreferrer">스테이트 패턴 예제<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div></div> <div class="column no-pad-r sm-25 xl-33 xsNone smNone post-sidebar"><div class="bizu box-default post-sidebar__bizu bizu--vertical"><div class="bizu-image"><span class="bizu-close">×</span> <a href="YOUR_AFFILIATE_LINK" target="_blank" rel="nofollow noopener"><img src="/general/web-development.png" alt="Illustration of a user studying online" class="bizu-image__image"></a></div> <div class="bizu-info"><a href="YOUR_AFFILIATE_LINK" target="_blank" rel="nofollow noopener" class="bizu-info__link bizu-info__text">
        The most complete course of Vue.js from Udemy, including Vuex and Vue-router with a promotional price not to be missed.
      </a> <a href="http://bit.ly/all-courses-udemy" target="_blank" rel="nofollow noopener" class="bizu-info__link bizu-info__by">
        udemy.com
      </a></div></div></div> <aside class="column xs-100"><hr class="divider"> <div><div class="observer"><!----> <!----> <!----></div></div> <hr class="divider"> <section class="post-content__disqus"><h3>Leave us a comment, what do you think?</h3> <!----></section></aside></div></section></article></div> <section class="row section-newsletter justify-center"><div class="column sm-100 md-67 xl-50"><div class="newsletter"><span class="meta-text meta-text--primary">Stay in</span> <h2 class="newsletter__title">Receive our articles, videos and more directly in your inbox and stay up to date.</h2> <form method="post" action="MY_ACTION_FOR_ENGLISH_USERS" class="newsletter__form"><label for="email_news-1544622885709" class="newsletter__label"><input type="email" name="EMAIL" id="email_news-1544622885709" required="required" placeholder="Enter your email here" aria-label="Enter your email here" value="" class="ui-input-field reset-input newsletter__input"></label> <button type="submit" class="ui-button reset-button newsletter__button txt-upper ui-button--primary">
          subscribe
        </button></form></div></div></section> <aside class="container main"></aside></div> <!----> <div class="elevator"><a class="elevator__link"><span class="icon elevator__icon">greaterthan</span></a></div> <!----></div></main> <footer class="footer"><div class="footer-box1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1366 161" class="footer-box__shape"><path d="M-11.925-4809v-154.746c40.454,19.75,273.683,130.936,420.544,142.612,161.25,12.821,339.978-42.709,521.543-86.3,169.82-40.769,395.43,29.2,423.912,38.429v60Z" transform="translate(11.926 4970)"></path></svg></div> <div class="footer-box2"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1366 246" class="footer-box__shape"><path d="M-1505.5-4725.5v-238.1c8.149-3.133,18.138-5.059,29.672-5.9h30.954c201.21,11.667,696.6,224.535,855.572,236.458,205.129,15.385,287.179-164.1,432.047-175.625a42.381,42.381,0,0,1,16.756,1.857V-4725.5Z" transform="translate(1506 4971)"></path></svg> <ul class="footer-social__list"><li class="footer-social__item"><a href="https://github.com/CheolHoJung" target="_blank" rel="noopener external" title="Follow us on Facebook"><span class="icon footer-social__icon">github</span></a></li></ul> <div class="footer-newsletter"><div class="newsletter"><span class="meta-text meta-text--primary">Stay in</span> <h2 class="newsletter__title">Receive our articles, videos and more directly in your inbox and stay up to date.</h2> <form method="post" action="MY_ACTION_FOR_ENGLISH_USERS" class="newsletter__form"><label for="email_news-1544622885711" class="newsletter__label"><input type="email" name="EMAIL" id="email_news-1544622885711" required="required" placeholder="Enter your email here" aria-label="Enter your email here" value="" class="ui-input-field reset-input newsletter__input"></label> <button type="submit" class="ui-button reset-button newsletter__button txt-upper ui-button--primary">
          subscribe
        </button></form></div></div></div> <section class="footer-box3"><div class="row"><div class="column sm-50 footer-card"><div class="observer"><div class="spinner observer__spinner"><div class="double-bounce1"></div> <div class="double-bounce2"></div></div> <!----> <!----></div></div> <div class="column sm-50 footer-nav"><div class="row justify-right"><div class="column xs-50 sm-40 md-33 footer-nav__box footer-nav__box--1"><h2 class="meta-text title">Jcheolho blog</h2> <nav class="footer-nav1"><ul><li class="footer-nav1__item"><a href="/about/">ABOUT</a> <!----></li><li class="footer-nav1__item"><a href="/categories/">CATEGORIES</a> <!----></li><li class="footer-nav1__item"><a href="/contact/">CONTACT</a> <!----></li></ul></nav></div> <!----></div></div> <div class="column sm-100 footer-copy">2018 © MY_BLOG_NAME - 
        <a href="https://vuepress.vuejs.org/" rel="noopener" target="_blank">
          MADE WITH VUEPRESS
        </a></div></div> <span class="shapes shapes--circle" style="left: 3%; top: -20%"></span> <span class="shapes shapes--primary shapes--color3" style="left: 30%; top: -15%"></span> <span class="shapes shapes--primary" style="left: 13%; top: -80%; transform: rotate(45deg)"></span> <span class="shapes shapes--circle shapes--color4" style="left: 40%; top: 200px"></span> <span class="shapes shapes--primary" style="left: 15%; bottom: 10%; transform: rotate(75deg)"></span> <span class="shapes shapes--circle shapes--color3" style="right: 50%; top: 30%"></span> <span class="shapes shapes--primary" style="right: 20%; top: -100%"></span> <span class="shapes shapes--circle" style="right: 10%; top: -20%"></span> <span class="shapes shapes--color4" style="right: 35%; top: -20%; transform: rotate(45deg)"></span> <span class="shapes shapes--circle" style="left: 40%; top: -50%"></span> <span class="shapes shapes--color3" style="right: 30%; top: 20%"></span> <span class="shapes shapes--circle shapes--primary" style="right: 30%; bottom: 20%"></span></section></footer></div> <!----> <!----></div></div>
    <script src="/assets/js/app.bfe739c4.js" defer></script><script src="/assets/js/13.9279a9ff.js" defer></script><script src="/assets/js/3.23193c0c.js" defer></script><script src="/assets/js/12.3e016781.js" defer></script><script src="/assets/js/11.809e9d83.js" defer></script><script src="/assets/js/16.1c2833b5.js" defer></script><script src="/assets/js/2.5fe2a2c5.js" defer></script><script src="/assets/js/5.b501fc84.js" defer></script><script src="/assets/js/6.14ae626b.js" defer></script><script src="/assets/js/17.49af5d66.js" defer></script><script src="/assets/js/55.8758e0e4.js" defer></script><script src="/assets/js/7.2fece6bb.js" defer></script><script src="/assets/js/1.68f42ae0.js" defer></script><script src="/assets/js/9.9f978aa2.js" defer></script><script src="/assets/js/14.53747437.js" defer></script><script src="/assets/js/4.b9cce61f.js" defer></script>
  </body>
</html>
